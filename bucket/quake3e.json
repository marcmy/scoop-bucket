{
  "version": "0.0.0.0",
  "description": "Quake III engine fork focused on performance, fixes and QoL (Quake3e).",
  "homepage": "https://github.com/ec-/Quake3e",
  "license": "GPL-2.0-or-later",

  "architecture": {
    "64bit": {
      "url": "https://github.com/ec-/Quake3e/releases/download/latest/quake3e-windows-mingw-x86_64.zip",
      "hash": "807f0fc5fe5583c4ab2f633aa53eb1b0279f4784649cf6b75250b16ff4d733f7",
      "bin": [
        ["quake3.x64.exe", "quake3e", "+set fs_homepath \"$persist_dir\""],
        ["quake3e-vulkan.x64.exe", "quake3e-vulkan", "+set fs_homepath \"$persist_dir\""],
        ["quake3e.ded.x64.exe", "quake3e-ded", "+set fs_homepath \"$persist_dir\" +set dedicated 1"]
      ]
    },
    "32bit": {
      "url": "https://github.com/ec-/Quake3e/releases/download/latest/quake3e-windows-mingw-x86.zip",
      "hash": "4b6db62f1d65b56539cd4765a175b562937c6697cb6894520b9f1fc70c51a9a1",
      "bin": [
        ["quake3e.exe", "quake3e", "+set fs_homepath \"$persist_dir\""],
        ["quake3e-vulkan.exe", "quake3e-vulkan", "+set fs_homepath \"$persist_dir\""],
        ["quake3e.ded.exe", "quake3e-ded", "+set fs_homepath \"$persist_dir\" +set dedicated 1"]
      ]
    },
    "arm64": {
      "url": "https://github.com/ec-/Quake3e/releases/download/latest/quake3e-windows-msvc-arm64.zip",
      "hash": "787e2f952c07e91bd63baa20cff279876f7caeb93bfd04430b72888a104e69fa",
      "bin": [
        ["quake3.arm64.exe", "quake3e", "+set fs_homepath \"$persist_dir\""],
        ["quake3e-vulkan.arm64.exe", "quake3e-vulkan", "+set fs_homepath \"$persist_dir\""],
        ["quake3.ded.arm64.exe", "quake3e-ded", "+set fs_homepath \"$persist_dir\" +set dedicated 1"]
      ]
    }
  },

  "persist": [
    "baseq3",
    "missionpack",
    "link_target.txt"
  ],

  "installer": {
    "script": [
      "$ErrorActionPreference = 'SilentlyContinue'",
      "$cfg = Join-Path $persist_dir 'link_target.txt'",
      "if (!(Test-Path $persist_dir)) { New-Item -ItemType Directory -Path $persist_dir | Out-Null }",
      "$target = $null",
      "if (Test-Path $cfg) { $target = Get-Content $cfg -Raw }",
      "if (-not $target) {",
      "  $target = Read-Host 'Enter full path to your Quake III install (folder that contains baseq3)'",
      "  if (-not (Test-Path $target)) {",
      "    Write-Host 'Path does not exist. Skipping link setup this time. Re-run install to try again.' -ForegroundColor Yellow",
      "  } else {",
      "    Set-Content -Path $cfg -Value $target",
      "  }",
      "}",
      "if ($target -and (Test-Path $target)) {",
      "  $names = @(",
      "    'quake3e.exe','quake3e-vulkan.exe','quake3e.ded.exe',",
      "    'quake3.x64.exe','quake3e-vulkan.x64.exe','quake3e.ded.x64.exe',",
      "    'quake3.arm64.exe','quake3e-vulkan.arm64.exe','quake3.ded.arm64.exe'",
      "  ) | Where-Object { Test-Path (Join-Path $dir $_) }",
      "  foreach ($n in $names) {",
      "    $src = Join-Path $dir $n",
      "    $dst = Join-Path $target $n",
      "    if (Test-Path $dst) { Remove-Item $dst -Force }",
      "    $sameDrive = ([System.IO.Path]::GetPathRoot($src)) -eq ([System.IO.Path]::GetPathRoot($dst))",
      "    try {",
      "      if ($sameDrive) { New-Item -ItemType HardLink -Path $dst -Target $src | Out-Null }",
      "      else { New-Item -ItemType SymbolicLink -Path $dst -Target $src | Out-Null }",
      "    } catch { Copy-Item $src $dst -Force }",
      "  }",
      "  Write-Host ('Linked {0} binaries into: {1}' -f $names.Count, $target) -ForegroundColor Green",
      "  Write-Host 'Note: Symlinks across drives may need Developer Mode/admin; fallback is copy.' -ForegroundColor DarkGray",
      "}"
    ]
  },

  "uninstaller": {
    "script": [
      "$cfg = Join-Path $persist_dir 'link_target.txt'",
      "if (Test-Path $cfg) {",
      "  $target = Get-Content $cfg -Raw",
      "  if (Test-Path $target) {",
      "    $names = @(",
      "      'quake3e.exe','quake3e-vulkan.exe','quake3e.ded.exe',",
      "      'quake3.x64.exe','quake3e-vulkan.x64.exe','quake3e.ded.x64.exe',",
      "      'quake3.arm64.exe','quake3e-vulkan.arm64.exe','quake3.ded.arm64.exe'",
      "    )",
      "    foreach ($n in $names) {",
      "      $dst = Join-Path $target $n",
      "      if (Test-Path $dst) { try { Remove-Item $dst -Force } catch {} }",
      "    }",
      "  }",
      "}"
    ]
  },

"checkver": {
  "script": [
    "$ErrorActionPreference = 'Stop'",
    "$headers = @{ 'User-Agent' = 'Scoop-Checkver'; 'Accept' = 'application/vnd.github+json' }",
    "$r = Invoke-RestMethod -Headers $headers -Uri 'https://api.github.com/repos/ec-/Quake3e/releases/tags/latest'",
    "$ver = [datetime]$r.published_at",
    "$assets = $r.assets",
    "$global:matchWin64    = ($assets | Where-Object { $_.name -match 'win.*(x86_64|64).*\\.zip' }).name",
    "$global:matchWin32    = ($assets | Where-Object { $_.name -match 'win.*(x86(?!_64)|32).*\\.zip' }).name",
    "$global:matchWinArm64 = ($assets | Where-Object { $_.name -match 'win.*arm64.*\\.zip' }).name",
    "$global:matchLinux64  = ($assets | Where-Object { $_.name -match 'linux.*(x86_64|64).*\\.zip' }).name",
    "$global:matchLinux32  = ($assets | Where-Object { $_.name -match 'linux.*(x86(?!_64)|32).*\\.zip' }).name",
    "$global:matchLinuxArm = ($assets | Where-Object { $_.name -match 'linux.*arm64.*\\.zip' }).name",
    "$global:matchMac64    = ($assets | Where-Object { $_.name -match 'mac.*(x86_64|x64).*\\.zip' }).name",
    "$global:matchMacArm   = ($assets | Where-Object { $_.name -match 'mac.*(aarch64|arm64).*\\.zip' }).name",
    "($ver).ToString('yyyy.MM.dd.HH')"
  ]
}


  "autoupdate": {
    "architecture": {
      "64bit": {
        "url": "https://github.com/ec-/Quake3e/releases/download/$tag/$matchWin64",
        "hash": {
          "url": "https://api.github.com/repos/ec-/Quake3e/releases/tags/latest",
          "regex": "(?is)$matchWin64\\s*\\r?\\nsha256:([a-f0-9]{64})"
        }
      },
      "32bit": {
        "url": "https://github.com/ec-/Quake3e/releases/download/$tag/$matchWin32",
        "hash": {
          "url": "https://api.github.com/repos/ec-/Quake3e/releases/tags/latest",
          "regex": "(?is)$matchWin32\\s*\\r?\\nsha256:([a-f0-9]{64})"
        }
      },
      "arm64": {
        "url": "https://github.com/ec-/Quake3e/releases/download/$tag/$matchWinArm64",
        "hash": {
          "url": "https://api.github.com/repos/ec-/Quake3e/releases/tags/latest",
          "regex": "(?is)$matchWinArm64\\s*\\r?\\nsha256:([a-f0-9]{64})"
        }
      }
    }
  }
}
